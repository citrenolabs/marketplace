from __future__ import annotations

INTEGRATION_NAME = "VectraRUX"
DEFAULT_DEVICE_VENDOR = "Vectra AI"
VECTRA_RUX = "Vectra RUX"
DEFAULT_DEVICE_PRODUCT = VECTRA_RUX
RULE_GENERATOR = VECTRA_RUX

NEXT_PAGE_URL_KEY = "next"
RESULT_VALUE_TRUE = True
RESULT_VALUE_FALSE = False
COMMON_ACTION_ERROR_MESSAGE = "Error while executing action {}. Reason: {}"
DEFAULT_TIME_FRAME = 0
DEFAULT_ENTITY_TYPE = "Host"

PING_SCRIPT_NAME = f"{INTEGRATION_NAME} - Ping"
JOB_SCRIPT_NAME = f"{INTEGRATION_NAME} - Clear Empty Cases"
ADD_TAGS_SCRIPT_NAME = f"{INTEGRATION_NAME} - Add Tags"
REMOVE_TAGS_SCRIPT_NAME = f"{INTEGRATION_NAME} - Remove Tags"
DOWNLOAD_PCAP_SCRIPT_NAME = f"{INTEGRATION_NAME} - Download PCAP"
UPDATE_ASSIGNMENT_SCRIPT_NAME = f"{INTEGRATION_NAME} - Update Assignment"
REMOVE_ASSIGNMENT_SCRIPT_NAME = f"{INTEGRATION_NAME} - Remove Assignment"
LIST_ASSIGNMENTS_SCRIPT_NAME = f"{INTEGRATION_NAME} - List Assignments"
DESCRIBE_ASSIGNMENT_SCRIPT_NAME = f"{INTEGRATION_NAME} - Describe Assignment"
DESCRIBE_DETECTION_SCRIPT_NAME = f"{INTEGRATION_NAME} - Describe Detections"
DESCRIBE_ENTITY_SCRIPT_NAME = f"{INTEGRATION_NAME} - Describe Entity"
LIST_ENTITY_DETECTIONS_SCRIPT_NAME = f"{INTEGRATION_NAME} - List Entity Detections"
LIST_ENTITIES_SCRIPT_NAME = f"{INTEGRATION_NAME} - List Entities"
LIST_USERS_SCRIPT_NAME = f"{INTEGRATION_NAME} - List Users"
LIST_OUTCOMES_SCRIPT_NAME = f"{INTEGRATION_NAME} - List Outcomes"
UNMARK_DETECTION_FIXED_SCRIPT_NAME = f"{INTEGRATION_NAME} - Unmark Detection Fixed"
MARK_DETECTION_FIXED_SCRIPT_NAME = f"{INTEGRATION_NAME} - Mark Detection Fixed"
LIST_GROUPS_SCRIPT_NAME = f"{INTEGRATION_NAME} - List Groups"
ADD_NOTE_SCRIPT_NAME = f"{INTEGRATION_NAME} - Add Note"
REMOVE_NOTE_SCRIPT_NAME = f"{INTEGRATION_NAME} - Remove Note"
MARK_ENTITY_FIXED_SCRIPT_NAME = f"{INTEGRATION_NAME} - Mark Entity Fixed"
LIST_DETECTIONS_SCRIPT_NAME = f"{INTEGRATION_NAME} - List Detections"
RESOLVE_ASSIGNMENT_SCRIPT_NAME = f"{INTEGRATION_NAME} - Resolve Assignment"
ASSIGN_ENTITY_SCRIPT_NAME = f"{INTEGRATION_NAME} - Assign Entity"
ASSIGN_GROUP_SCRIPT_NAME = f"{INTEGRATION_NAME} - Assign Group"
REMOVE_GROUP_SCRIPT_NAME = f"{INTEGRATION_NAME} - Remove Group"

CONNECTOR_NAME = f"{INTEGRATION_NAME} - Entities Connector"

VECTRA_DATETIME_FORMAT = "%Y-%m-%dT%H%M"
FIRST_TIMESTAMP_FORMAT = "%Y-%m-%dT%H:%M:%SZ"

DEFAULT_PAGE_SIZE = 1000
RETRY_COUNT = 3
RETRY_COUNT_TOKEN = 1
WAIT_TIME_FOR_RETRY = 5
DEFAULT_RESULTS_LIMIT = 10000000
DEFAULT_REQUEST_TIMEOUT = 60
RATE_LIMIT_EXCEEDED_STATUS_CODE = 429
MAX_IDS = 10000

API_VERSION = "api/v3.4"
URL_API_VERSION = "/" + API_VERSION

entity_types = ["account", "host"]

HOSTS = "hosts"
ACCOUNTS = "accounts"
DETECTIONS = "detections"
ASSIGNMENTS = "assignments"
USERS = "users"
ENTITIES = "entities"
GROUPS = "groups"
OUTCOMES = "assignment_outcomes"
ENTITY_TYPE = "Entity Type"
ENTITY_ID = "Entity ID"

PING = "PING"
LIST_HOSTS_API_KEY = "LIST_HOST"
LIST_ASSIGNMENTS_API_NAME = "LIST_ASSIGNMENTS"
LIST_DETECTIONS_API_NAME = "LIST_DETECTIONS"
ASSIGNMENT_API_NAME = "ASSIGNMENT"
LIST_ENTITIES_API_NAME = "LIST_ENTITIES"
TAGGING_API_NAME = "TAGGING"
DESCRIBE_DETECTION_API_NAME = "DESCRIBE_DETECTION"
DESCRIBE_ENTITY_API_NAME = "DESCRIBE_ENTITY"
LIST_ENTITY_API_NAME = "LIST_ENTITY"
LIST_USERS_API_NAME = "LIST_USERS"
LIST_OUTCOMES_API_NAME = "LIST_OUTCOMES"
MARK_DETECTION_API_NAME = "MARK_DETECTION"
LIST_GROUPS_API_NAME = "LIST_GROUPS"
ADD_NOTE_API_NAME = "ADD_NOTE"
REMOVE_NOTE_API_NAME = "REMOVE_NOTE"
RESOLVE_ASSIGNMENT_API_NAME = "RESOLVE_ASSIGNMENT"
ASSIGN_ENTITY_API_NAME = "LIST_ASSIGNMENTS"
DOWNLOAD_PCAP_API_NAME = "DOWNLOAD_PCAP"
UPDATE_GROUP_MEMBERS_API_NAME = "UPDATE_GROUP"

ENDPOINTS = {
    PING: "oauth2/token",
    LIST_HOSTS_API_KEY: f"{API_VERSION}/{HOSTS}",
    LIST_ASSIGNMENTS_API_NAME: f"{API_VERSION}/{ASSIGNMENTS}",
    LIST_DETECTIONS_API_NAME: f"{API_VERSION}/{DETECTIONS}",
    ASSIGNMENT_API_NAME: f"{API_VERSION}/{ASSIGNMENTS}" + "/{assignment_id}",
    LIST_ENTITIES_API_NAME: f"{API_VERSION}/{ENTITIES}",
    TAGGING_API_NAME: f"{API_VERSION}/tagging/entity" + "/{entity_id}",
    DESCRIBE_DETECTION_API_NAME: f"{API_VERSION}/{DETECTIONS}" + "/{detection_id}",
    DESCRIBE_ENTITY_API_NAME: f"{API_VERSION}/{ENTITIES}/"
    + "{entity_id}/?type={entity_type}",
    LIST_ENTITY_API_NAME: f"{API_VERSION}" + "/{entity_type}s" + "/{entity_id}",
    LIST_USERS_API_NAME: f"{API_VERSION}/{USERS}",
    LIST_OUTCOMES_API_NAME: f"{API_VERSION}/{OUTCOMES}",
    MARK_DETECTION_API_NAME: f"{API_VERSION}/{DETECTIONS}",
    LIST_GROUPS_API_NAME: f"{API_VERSION}/{GROUPS}",
    ADD_NOTE_API_NAME: f"{API_VERSION}" + "/entities/{entity_id}/notes",
    REMOVE_NOTE_API_NAME: f"{API_VERSION}" + "/entities/{entity_id}/notes/{note_id}",
    RESOLVE_ASSIGNMENT_API_NAME: f"{API_VERSION}/{ASSIGNMENTS}"
    + "/{assignment_id}/resolve",
    DOWNLOAD_PCAP_API_NAME: f"{API_VERSION}/{DETECTIONS}" + "/{detection_id}/pcap",
    UPDATE_GROUP_MEMBERS_API_NAME: f"{API_VERSION}/{GROUPS}" + "/{group_id}",
}

GROUP_TYPE_FIELD_MAPPING = {
    "host": "name",
    "ip": "ip",
    "account": "uid",
    "domain": "domain",
}

VECTRA_REFRESH_TOKEN_EXPIRE_MESSAGE = (
    "Please try reauthenticating using API client credentials"
)

SEVERITY_MAP = {"low": 40, "medium": 60, "high": 80, "critical": 100}

# Job constants
DEFAULT_HOURS_BACKWARDS = "24"
CASE_DEFAULT_PRODUCTNAME = [DEFAULT_DEVICE_PRODUCT]
CASE_STATUS = "OPEN"
CASE_DEFAULT_ENVIRONMENT = ["Default Environment"]
CASES_TIMESTAMP_DB_KEY = "cases_timestamp"
CASE_ROOT_CAUSE = "Similar case already under investigation"
ALERT_ROOT_CAUSE = "Similar alert already under investigation"
CASE_ALERT_REASON = 1

UNIX_FORMAT = 1
DATETIME_FORMAT = 2
NUM_OF_MILLI_IN_SEC = 1000
MAX_OPEN_CASES = 10000
