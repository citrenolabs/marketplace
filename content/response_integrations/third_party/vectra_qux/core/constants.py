from __future__ import annotations

INTEGRATION_NAME = "VectraQUX"
DEFAULT_DEVICE_VENDOR = "Vectra AI"
VECTRA_QUX = "Vectra QUX"
DEFAULT_DEVICE_PRODUCT = VECTRA_QUX
RULE_GENERATOR = VECTRA_QUX

NEXT_PAGE_URL_KEY = "next"
RESULT_VALUE_TRUE = True
RESULT_VALUE_FALSE = False
COMMON_ACTION_ERROR_MESSAGE = "Error while executing action {}. Reason: {}"
VECTRA_DATETIME_FORMAT = "%Y-%m-%dT%H%M"
FIRST_TIMESTAMP_FORMAT = "%Y-%m-%dT%H:%M:%SZ"

PING_SCRIPT_NAME = f"{INTEGRATION_NAME} - Ping"
JOB_SCRIPT_NAME = f"{INTEGRATION_NAME} - Clear Empty Cases"
ADD_TAGS_SCRIPT_NAME = f"{INTEGRATION_NAME} - Add Tags"
REMOVE_TAGS_SCRIPT_NAME = f"{INTEGRATION_NAME} - Remove Tags"
DESCRIBE_DETECTION_SCRIPT_NAME = f"{INTEGRATION_NAME} - Describe Detections"
LIST_ASSIGNMENTS_SCRIPT_NAME = f"{INTEGRATION_NAME} - List Assignments"
DESCRIBE_ASSIGNMENT_SCRIPT_NAME = f"{INTEGRATION_NAME} - Describe Assignment"
DESCRIBE_ENTITY_SCRIPT_NAME = f"{INTEGRATION_NAME} - Describe Entity"
ENTITY_DETECTION_LIST_SCRIPT_NAME = f"{INTEGRATION_NAME} - Entity Detection List"
HOSTS_SEARCH_SCRIPT_NAME = f"{INTEGRATION_NAME} - Search Hosts"
ACCOUNTS_SEARCH_SCRIPT_NAME = f"{INTEGRATION_NAME} - Search Accounts"
SEARCH_DETECTIONS_SCRIPT_NAME = f"{INTEGRATION_NAME} - Search Detections"
LIST_ENTITY_DETECTIONS_SCRIPT_NAME = f"{INTEGRATION_NAME} - List Entity Detections"
SEARCH_HOSTS_SCRIPT_NAME = f"{INTEGRATION_NAME} - Search Hosts"
SEARCH_ACCOUNTS_SCRIPT_NAME = f"{INTEGRATION_NAME} - Search Accounts"
UPDATE_ASSIGNMENT_SCRIPT_NAME = f"{INTEGRATION_NAME} - Update Assignment"
REMOVE_ASSIGNMENT_SCRIPT_NAME = f"{INTEGRATION_NAME} - Remove Assignment"
LIST_USERS_SCRIPT_NAME = f"{INTEGRATION_NAME} - List Users"
LIST_GROUPS_SCRIPT_NAME = f"{INTEGRATION_NAME} - List Groups"
LIST_OUTCOMES_SCRIPT_NAME = f"{INTEGRATION_NAME} - List Outcomes"
MARK_DETECTION_FIXED_SCRIPT_NAME = f"{INTEGRATION_NAME} - Mark Detection Fixed"
UNMARK_DETECTION_FIXED_SCRIPT_NAME = f"{INTEGRATION_NAME} - Unmark Detection Fixed"
ADD_OUTCOME_SCRIPT_NAME = f"{INTEGRATION_NAME} - Add Outcome"
RESOLVE_ASSIGNMENT_SCRIPT_NAME = f"{INTEGRATION_NAME} - Resolve Assignment"
ADD_NOTE_SCRIPT_NAME = f"{INTEGRATION_NAME} - Add Note"
REMOVE_NOTE_SCRIPT_NAME = f"{INTEGRATION_NAME} - Remove Note"
ASSIGN_ENTITY_SCRIPT_NAME = f"{INTEGRATION_NAME} - Assign Entity"
MARK_ENTITY_FIXED_SCRIPT_NAME = f"{INTEGRATION_NAME} - Mark Entity Fixed"
DOWNLOAD_PCAP_SCRIPT_NAME = f"{INTEGRATION_NAME} - Download PCAP"
ASSIGN_GROUP_SCRIPT_NAME = f"{INTEGRATION_NAME} - Assign Group"
REMOVE_GROUP_SCRIPT_NAME = f"{INTEGRATION_NAME} - Remove Group"

CONNECTOR_NAME = f"{INTEGRATION_NAME} - Entities Connector"
VECTRA_DATETIME_FORMAT = "%Y-%m-%dT%H%M"
FIRST_TIMESTAMP_FORMAT = "%Y-%m-%dT%H:%M:%SZ"

DEFAULT_PAGE_SIZE = 1000
RETRY_COUNT = 3
WAIT_TIME_FOR_RETRY = 5
DEFAULT_RESULTS_LIMIT = 10000000
RATE_LIMIT_EXCEEDED_STATUS_CODE = 429
DEFAULT_REQUEST_TIMEOUT = 60
MAX_IDS = 10000

DEFAULT_TIME_FRAME = 0
DEFAULT_ENTITY_TYPE = "Host"

API_VERSION = "api/v2.5"
API_VERSION_2_5 = "/api/v2.5"
API_VERSION_2_1 = "/api/v2.1"
API_VERSION_2_2 = "/api/v2.2"

HOSTS = "hosts"
ACCOUNTS = "accounts"
DETECTIONS = "detections"
ASSIGNMENTS = "assignments"
USERS = "users"
GROUPS = "groups"
OUTCOMES = "assignment_outcomes"
ENTITY_TYPE = "Entity Type"
ENTITY_ID = "Entity ID"

LIST_HOSTS_API_NAME = "LIST_HOSTS"
SEARCH_HOSTS_API_NAME = "SEARCH_HOSTS"
SEARCH_ACCOUNTS_API_NAME = "SEARCH_ACCOUNTS"
DESCRIBE_HOST_API_NAME = "DESCRIBE_HOST"
DESCRIBE_ACCOUNT_API_NAME = "DESCRIBE_ACCOUNT"
DESCRIBE_DETECTION_API_NAME = "DESCRIBE_DETECTION"
LIST_DETECTION_API_NAME = "LIST_DETECTION"
LIST_ASSIGNMENTS_API_NAME = "LIST_ASSIGNEMENTS"
TAGGING_API_NAME = "TAGGING"
DESCRIBE_ENTITY_API_NAME = "DESCRIBE_ENTITY"
LIST_ENTITY_DETECTIONS_API_NAME = "LIST_ENTITY_DETECTIONS"
ASSIGNMENT_API_NAME = "ASSIGNMENT"
LIST_USERS_API_NAME = "LIST_USERS"
LIST_GROUPS_API_NAME = "LIST_GROUPS"
LIST_OUTCOMES_API_NAME = "LIST_OUTCOMES"
MARK_DETECTION_API_NAME = "MARK_DETECTION"
ADD_OUTCOME_API_NAME = "ADD_OUTCOME"
RESOLVE_ASSIGNMENT_API_NAME = "RESOLVE_ASSIGNMENT"
ADD_NOTE_API_NAME = "ADD_NOTE"
REMOVE_NOTE_API_NAME = "REMOVE_NOTE"
SEARCH_DETECTIONS_API_NAME = "SEARCH_DETECTIONS"
ASSIGN_ENTITY_API_NAME = "LIST_ASSIGNEMENTS"
DOWANLOAD_PCAP_API_NAME = "DOWNLOAD_PCAP"
UPDATE_GROUP_MEMBERS_API_NAME = "UPDATE_GROUP"
ENTITY_SEARCH_API_NAME = "ENTITY_SEARCH"
LIST_ENTITY_DETECTIONS_QUERY_PARAM = '?query_string=detection.src_{entity_type}.id:{entity_id} AND detection.state:"{state}"'

ENDPOINTS = {
    SEARCH_HOSTS_API_NAME: f"{API_VERSION}/{HOSTS}",
    SEARCH_ACCOUNTS_API_NAME: f"{API_VERSION}/{ACCOUNTS}",
    DESCRIBE_DETECTION_API_NAME: f"{API_VERSION}/{DETECTIONS}" + "/{detection_id}",
    LIST_HOSTS_API_NAME: f"{API_VERSION}/hosts",
    LIST_DETECTION_API_NAME: f"{API_VERSION}/search/{DETECTIONS}",
    LIST_ASSIGNMENTS_API_NAME: f"{API_VERSION}/{ASSIGNMENTS}",
    TAGGING_API_NAME: f"{API_VERSION}/tagging" + "/{entity_type}/{entity_id}",
    DESCRIBE_ENTITY_API_NAME: f"{API_VERSION}" + "/{entity_type}/{entity_id}",
    LIST_ENTITY_DETECTIONS_API_NAME: f"{API_VERSION}/search/{DETECTIONS}",
    ASSIGNMENT_API_NAME: f"{API_VERSION}/{ASSIGNMENTS}" + "/{assignment_id}",
    LIST_USERS_API_NAME: f"{API_VERSION}/{USERS}",
    LIST_GROUPS_API_NAME: f"{API_VERSION}/{GROUPS}",
    LIST_OUTCOMES_API_NAME: f"{API_VERSION}/{OUTCOMES}",
    MARK_DETECTION_API_NAME: f"{API_VERSION}/{DETECTIONS}",
    ADD_OUTCOME_API_NAME: f"{API_VERSION}/{OUTCOMES}",
    RESOLVE_ASSIGNMENT_API_NAME: f"{API_VERSION}/{ASSIGNMENTS}"
    + "/{assignment_id}/resolve",
    ADD_NOTE_API_NAME: f"{API_VERSION}" + "/{entity_type}/{entity_id}/notes",
    REMOVE_NOTE_API_NAME: f"{API_VERSION}"
    + "/{entity_type}/{entity_id}/notes/{note_id}",
    SEARCH_DETECTIONS_API_NAME: f"{API_VERSION}/{DETECTIONS}",
    DOWANLOAD_PCAP_API_NAME: f"{API_VERSION}/{DETECTIONS}" + "/{detection_id}/pcap",
    UPDATE_GROUP_MEMBERS_API_NAME: f"{API_VERSION}/{GROUPS}" + "/{group_id}",
    ENTITY_SEARCH_API_NAME: f"{API_VERSION}/search" + "/{entity_type}s",
}

GROUP_TYPE_FIELD_MAPPING = {
    "host": "name",
    "ip": "ip",
    "account": "uid",
    "domain": "domain",
}

SEVERITY_MAP = {"low": 40, "medium": 60, "high": 80, "critical": 100}

DETECTION_CATEGORIES = [
    "command & control",
    "botnet activity",
    "reconnaissance",
    "lateral movement",
    "exfiltration",
    "info",
]

# Job constants
DEFAULT_HOURS_BACKWARDS = "24"
CASE_DEFAULT_PRODUCTNAME = [DEFAULT_DEVICE_PRODUCT]
CASE_STATUS = "OPEN"
CASE_DEFAULT_ENVIRONMENT = ["Default Environment"]
CASES_TIMESTAMP_DB_KEY = "cases_timestamp"
CASE_ROOT_CAUSE = "Similar case already under investigation"
ALERT_ROOT_CAUSE = "Similar alert already under investigation"
CASE_ALERT_REASON = 1

UNIX_FORMAT = 1
DATETIME_FORMAT = 2
NUM_OF_MILLI_IN_SEC = 1000
MAX_OPEN_CASES = 10000
