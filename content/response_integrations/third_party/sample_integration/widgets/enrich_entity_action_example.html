<!-- Widget created by Enrichment Template / Version 1.0 / 2025-08-06 -->
<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700,700i" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css?family=Source Sans Pro" rel="stylesheet"/>
  <title>
   Sample Integration - Enrich Entity Action Example
  </title>
  <style>
   /* Root Variables */
    :root {
      --widget-bg: rgb(33, 44, 68);
      --widget-font-family: 'Source Sans Pro', sans-serif;
      --widget-text-color: rgb(255, 255, 255);
      --widget-scrollbar-size: 12px;
      --widget-row-highlight-bg: rgb(47 61 91);

      /*Logo styles*/
      --logo-size: 48px;
      --logo-color: rgb(255, 255, 255);
      /*Logo styles*/

      --divider-border-colcor: rgb(98, 117, 163);
      --divider-border-width: 1px;

      --header-title-font: 600 16px/22px var(--widget-font-family);
      --list-item-key-font: 600 14px/18px var(--widget-font-family);
      --list-item-value-font: 400 14px/18px var(--widget-font-family);
      --additional-title-font: 600 14px/18px var(--widget-font-family);

      /*Sidebar styles*/
      --sidebar-width: 167px;
      --sidebar-item-text-style: 400 14px/18px var(--widget-font-family);
      --sidebar-item-text-style-active: 600 14px/16px var(--widget-font-family);
      --sidebar-item-active-bg: rgb(58, 74, 108);
      --sidebar-item-padding: 10px;

      /*Table styles*/
      --table-color-even-row: rgb(26 32 50);
      --table-title-size: 600 14px/18px var(--widget-font-family);
      --table-th-size: 600 14px/18px var(--widget-font-family);
      --table-td-size: 400 14px/18px var(--widget-font-family);
    }

    /*Normalize CSS */
    * {
      margin: 0;
      padding: 0;
      outline: none;
      box-sizing: border-box;
    }

    *:hover, *:focus, *:active {
      outline: none;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      border-spacing: 0;
    }

    ol, ul {
      list-style: none;
    }

    button,
    input,
    textarea {
      font-family: inherit;
      background: transparent;
      border: 0;
      color: inherit;
      text-align: left;
    }

    button, a[href] {
      cursor: pointer;
    }

    /*Normalize CSS */


    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 18px;
      height: 18px;
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(137, 151, 180, 1);
      border: 6px solid var(--widget-bg);
      border-radius: 63px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
      border: 4px solid transparent;
      border-radius: 44px;
    }

    ::-webkit-scrollbar-corner {
      background-color: transparent;
      border-color: transparent;
    }

    body {
      font-family: var(--widget-font-family), serif;
      color: var(--widget-text-color);
      background-color: var(--widget-bg);
      overflow: hidden;
    }

    /*Global styles*/
    .text-ellipsis {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .divider-border-style {
      border: 0;
      border-color: var(--divider-border-colcor);
      border-style: solid;
    }

    .tooltip {
      max-width: 100%;
      position: absolute;
      padding: 8px 16px 8px 16px;
      border-radius: 4px;
      background-color: rgb(204 204 218);
      color: rgb(22, 22, 37);
      font: 400 14px/18px var(--widget-font-family);
      z-index: 9;
      word-wrap: break-word;
    }

    .tooltip-triangle {
      position: absolute;
      top: 100%;
      border-top: solid 8px rgb(195, 210, 232);
      border-left: solid 8px transparent;
      border-right: solid 8px transparent;
    }

    .input {
      border: 1px solid #6275A3;
      border-radius: 4px;
      padding: 4px 8px;
      background-color: transparent;
      font-size: 14px;
      color: var(--widget-text-color);
    }

    .input::placeholder {
      color: var(--widget-text-color);
    }

    /*Global styles*/

    .wrapper {
      display: flex;
      height: 100vh;
    }

    /*left sidebar*/
    .left-side {
      min-width: var(--sidebar-width);
      max-width: var(--sidebar-width);
      overflow-y: auto;
      padding-right: 6px;
      border-right-width: var(--divider-border-width);
    }

    .left-side-item {
      width: 100%;
      padding: var(--sidebar-item-padding);
      font: var(--sidebar-item-text-style);
    }

    .left-side-item.active {
      background-color: var(--sidebar-item-active-bg);
      font: var(--sidebar-item-text-style-active);
    }

    /*left sidebar*/

    .right-side {
      width: calc(100% - 168px);
      display: flex;
      flex-direction: column;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
      border-bottom-width: var(--divider-border-width);
    }

    .header-title {
      font: var(--header-title-font);
      word-break: break-word;
      padding: 0 6px;
    }

    .logo {
      min-width: var(--logo-size);
      min-height: var(--logo-size);
      max-width: var(--logo-size);
      max-height: var(--logo-size);
      color: var(--logo-color);
    }

    .main-content {
      flex: 1;
      overflow: auto;
    }

    .list:has(.list-item) {
      margin-bottom: 32px;
    }

    .list-item {
      display: flex;
      align-items: flex-start;
      gap: 6px;
      padding: 3px 6px;
    }

    .list-item:hover {
      background-color: var(--widget-row-highlight-bg);
    }

    .list-item + .list-item {
      margin-top: 6px;
    }

    .list-item-text {
      width: 50%;
      max-width: 300px;
      word-break: break-word;
    }

    .list-item-text-key {
      font: var(--list-item-key-font);
      text-transform: uppercase;
    }

    .list-item-text-value {
      font: var(--list-item-value-font);
    }

    .list-item-status-value {
      color: rgb(200, 200, 200);
    }

    .list-item-specific-value {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .list-item-success-value {
      color: rgb(153, 215, 201);
    }

    .list-item-warning-value {
      color: rgb(255, 243, 113);
    }

    .list-item-error-value {
      color: rgba(255, 90, 80);
    }

    .list-item-status-value:first-letter {
      text-transform: uppercase;
    }

    .list-item-screenshot {
      justify-content: center;
    }

    .list-item-screenshot-text {
      display: none;
    }

    @media screen and (min-width: 700px) {
      .list-item-text-value {
        max-width: 100%;
        width: 100%;
      }

      .list-item-screenshot-text {
        display: block;
      }
    }

    .tag {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .tag-item {
      padding: 2px 12px;
      background-color: rgb(106, 113, 128);
      border-radius: 2px;
    }

    /*Table*/
    .table-wrapper {
      padding: 0 6px;
    }

    .table-wrapper + .table-wrapper {
      margin-top: 8px;
    }

    .table-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
    }

    .table-title {
      font: var(--table-title-size);
      text-transform: uppercase;
    }

    .table-row-count {
      display: flex;
      margin-right: auto;
      align-items: center;
      white-space: nowrap;
      gap: 6px;
      font: var(--table-title-size);
    }

    .table-search-input {
      max-width: 200px;
    }

    @media screen and (max-width: 700px) {
      .table-search-input {
        max-width: 150px;
      }
    }

    .table-container {
      overflow: auto;
    }

    .table {
      table-layout: fixed;
    }

    .table thead {
      position: sticky;
      top: 0;
      z-index: 9;
    }

    .table th {
      width: 250px;
      background-color: var(--widget-row-highlight-bg);
      color: var(--widget-text-color);
      font: var(--table-th-size);
      padding: 6px 12px;
      text-transform: uppercase;
      vertical-align: top;
      text-align: left;
    }

    .table tr:nth-child(even) {
      background-color: var(--table-color-even-row);
    }

    .table-resizable-line {
      position: absolute;
      inset: 3px 6px 3px auto;
      width: 2px;
      cursor: col-resize;
      user-select: none;
      background-color: rgb(98, 117, 163);
      z-index: 9;
    }

    .table-resizable-line::before, .table-resizable-line::after {
      content: '';
      position: absolute;
      inset: 0 auto;
      width: 6px;
    }

    .table-resizable-line::before {
      left: -6px;
    }

    .table-resizable-line::after {
      right: -6px;
    }

    .table td {
      padding: 8px 12px;
      font: var(--table-td-size);
      color: var(--widget-text-color);
      vertical-align: top;
    }

    .table-button {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .table-button-text {
      text-decoration: underline;
      line-height: 20px;
    }

    .table-button-icon {
      width: 20px;
      height: 20px;
    }

    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: var(--widget-bg);
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      padding: 16px;
      max-width: 90%;
      min-width: 50%;
      max-height: 90%;
      border-radius: 8px;
      z-index: 9999;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .modal-content {
      overflow: auto;
    }

    .modal-content img {
      display: flex;
      max-width: 100%;
      max-height: 100%;
      margin: 0 auto;
    }

    .modal-content pre {
      font: var(--table-td-size);
    }

    .modal-header {
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .modal-title {
      font: 600 20px/26px var(--widget-font-family);
      word-wrap: break-word;
      flex: 1;
    }

    .modal-close {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: flex-end;
    }

    .modal-close svg {
      width: 20px;
      height: 20px;
      stroke: #fff;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 999;
    }
  </style>
 </head>
 <body>
  <div class="wrapper">
   <div class="left-side divider-border-style" id="leftSide">
   </div>
   <div class="right-side" id="rightSide">
    <div class="header divider-border-style">
     <h1 class="header-title" id="headerTitle">
     </h1>
     <svg class="logo" fill="currentColor" id="Layer_1" style="enable-background:new 0
   0 25 25;" version="1.1" viewbox="0 0 25 25" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px">
      <g>
       <g>
        <path d="M20.9,13.8c0.1-0.4,0.1-0.8,0.1-1.3c0-0.4,0-0.9-0.1-1.3l1.9-1.8C22.9,9.3,23,9.1,23,8.9c0-0.2,0-0.4-0.1-0.6l-1.3-2.3
    c-0.1-0.2-0.3-0.3-0.4-0.4c-0.2-0.1-0.4-0.1-0.6,0l-2.5,0.7c-0.7-0.5-1.4-1-2.2-1.3l-0.6-2.5c0-0.2-0.2-0.4-0.3-0.5S14.5,2,14.3,2
    h-2.7c-0.2,0-0.4,0.1-0.5,0.2c-0.2,0.1-0.3,0.3-0.3,0.5l-0.6,2.5C9.4,5.4,8.6,5.9,7.9,6.4L5.5,5.7c-0.2-0.1-0.4,0-0.6,0
    C4.7,5.8,4.5,5.9,4.4,6.1L3.1,8.4C3,8.6,3,8.8,3,8.9c0,0.2,0.1,0.4,0.3,0.5l1.9,1.8C5.1,11.6,5,12.1,5,12.5c0,0.4,0,0.9,0.1,1.3
    l-1.9,1.8C3.1,15.7,3,15.9,3,16.1c0,0.2,0,0.4,0.1,0.6l1.3,2.3c0.1,0.1,0.2,0.2,0.3,0.3c0.1,0.1,0.3,0.1,0.4,0.1
    c0.1,0,0.2,0,0.2,0l2.5-0.7c0.7,0.5,1.4,1,2.2,1.3l0.6,2.5c0,0.2,0.2,0.4,0.3,0.5s0.3,0.2,0.5,0.2h2.7c0.2,0,0.4-0.1,0.5-0.2
    c0.2-0.1,0.3-0.3,0.3-0.5l0.6-2.5c0.8-0.3,1.6-0.7,2.2-1.3l2.5,0.7c0.1,0,0.2,0,0.2,0c0.2,0,0.3,0,0.4-0.1
    c0.1-0.1,0.2-0.2,0.3-0.3l1.3-2.3c0.1-0.2,0.1-0.4,0.1-0.6c0-0.2-0.1-0.4-0.3-0.5L20.9,13.8z
    M15.5,15c-0.7,0.7-1.6,1-2.5,1c-0.7,0-1.4-0.2-2-0.6c-0.6-0.4-1-0.9-1.3-1.6c-0.3-0.6-0.3-1.3-0.2-2c0.1-0.7,0.5-1.3,1-1.8s1.1-0.8,1.8-1c0.7-0.1,1.4-0.1,2,0.2
    c0.6,0.3,1.2,0.7,1.6,1.3c0.4,0.6,0.6,1.3,0.6,1.9C16.5,13.4,16.2,14.3,15.5,15z">
        </path>
       </g>
      </g>
     </svg>
    </div>
    <section class="main-content" id="mainContent">
    </section>
   </div>
  </div>
  <script>
   // JSON placeholder [{stepInstanceName}.JsonResult]
  const actionListData = [{stepInstanceName}.JsonResult];

  // Constant for fields that are allowed to be modified
  const allowlistedFields = [];

  // Constants for tooltip positioning
  const tooltipGap = 25;
  const tooltipTriangleHeight = 8;
  const tooltipTriangleMinGap = 5;
  const triangleWidth = 16;
  let tooltipTimeout = undefined;

  // Get all elements "table"
  const tables = document.getElementsByClassName("table");

  const tooltipDetectResizeObserver = new ResizeObserver((entries) => {
    for (const entry of entries) {
      const target = entry.target;
      if (target) {
        const {offsetWidth, scrollWidth} = target;
        if (scrollWidth > offsetWidth) {
          target.addEventListener("mouseover", createTooltipListener);
          target.addEventListener("mouseout", removeTooltipListener);
        } else {
          target.removeEventListener("mouseover", createTooltipListener);
          target.removeEventListener("mouseout", removeTooltipListener);
        }
      }
    }
  });

  // Filter actionListData based on allowlistedFields
  const filteredActionListData = actionListData
    .filter(el => el.Entity.trim() !== "" && Object.keys(el.EntityResult).length > 0)
    .map(el => {
      const filteredEntityResult = filterKeys(el.EntityResult, allowlistedFields);
      return {...el, EntityResult: filteredEntityResult};
    })
    .filter(el => Object.keys(el.EntityResult).length > 0);

  // Update the UI with filtered data
  if (filteredActionListData.length > 0) {
    renderKeysInUI(flattenKeys(filteredActionListData[0].EntityResult));

    headerTitle.textContent = filteredActionListData[0].Entity;

    filteredActionListData.forEach((el, index) => {
      const displayValue = el.Entity;
      const cleanDisplayValue = removeSpecialSymbols(displayValue);
      const button = document.createElement("button");
      button.id = cleanDisplayValue;
      button.classList.add("left-side-item");
      button.setAttribute("data-menu", "item");
      if (index === 0) {
        button.classList.add("active");
      }
      renderWithTooltip(button, displayValue);
      leftSide.append(button);
    });


    if (filteredActionListData.length === 1) {
      leftSide.remove();
      rightSide.style.width = "100%";
    } else {
      leftSide.addEventListener("click", event => {
        const target = event.target.closest("[data-menu='item']");
        if (!target) return;

        const id = target.id;
        const object = filteredActionListData.find(el => removeSpecialSymbols(el.Entity) === id);

        if (object) {
          mainContent.innerHTML = "";
          renderKeysInUI(flattenKeys(object.EntityResult));
          headerTitle.textContent = object.Entity;
          renderModal();
          for (let i = 0; i < tables.length; i++) {
            resizableGrid(tables[i]);
          }
        }
        document.querySelectorAll("[data-menu='item']").forEach(item => item.classList.remove("active"));
        target.classList.add("active");

        mainContent.scrollTop = 0;
      });
    }

    renderModal();
  }

  /**
   * Recursively flattens a nested object into an array of { key, value } pairs.
   */
  function flattenKeys(obj, parentKey = "", sep = " ") {
    let keys = [];
    for (let key in obj) {
      if (obj.hasOwnProperty(key)) {
        let combinedKey = parentKey ? `${parentKey}${sep}${key}` : key;

        if (Array.isArray(obj[key])) {
          keys.push({key: combinedKey, value: obj[key]});
        } else if (typeof obj[key] === "object" && obj[key] !== null) {
          let nestedKeys = flattenKeys(obj[key], combinedKey, sep);
          keys = [...keys, ...nestedKeys];
        } else {
          keys.push({key: combinedKey, value: obj[key]});
        }
      }
    }

    return keys;
  }

  /**
   * Returns transposed Array
   */
  function transposeArray(array) {
    const n = array.length;
    if (n === 0) {
      return [];
    }
    const m = array[0]?.length ?? 0;
    if (m === 0) {
      return [];
    }

    let transposedArray = new Array(m);
    for (let i = 0; i < m; i++) {
      transposedArray[i] = new Array(n);
    }

    for (let i = 0; i < n; i++) {
      for (let j = 0; j < m; j++) {
        transposedArray[j][i] = array[i][j];
      }
    }

    return transposedArray;
  }

  /**
   * Renders keys and their corresponding values in the UI.
   */
  function renderKeysInUI(keys) {
    const mainContent = document.getElementById("mainContent");
    const ul = document.createElement("ul");
    ul.classList.add("list");

    keys.forEach(({key, value}) => {
      if (!value && value !== false && typeof value !== "number") return;
      const li = document.createElement("li");
      li.classList.add("list-item");

      const spanElement = document.createElement("span");
      const spanKey = document.createElement("span");
      spanKey.classList.add("list-item-text", "list-item-text-key");
      renderWithTooltip(spanKey, convertCamelCaseToTitleCase(key));

      if (Array.isArray(value)) {
        spanElement.classList.add("list-item-text", "list-item-text-value", "tag");
        value.forEach(item => {
          if (typeof item === "object") return;
          const label = document.createElement("label");
          label.classList.add("tag-item");
          renderWithTooltip(label, item);
          spanElement.appendChild(label);
        });

        li.appendChild(spanKey);
        li.appendChild(spanElement);

      } else {
        spanElement.classList.add("list-item-text", "list-item-text-value");
        renderWithTooltip(spanElement, value);
        const lowerCaseValue = String(value).toLowerCase();
        if (value === false || lowerCaseValue === "false") {
          const icon = `<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7511 12.7518C15.3754 10.1275 15.3754 5.8726 12.7511 3.24827C10.1267 0.623948 5.87186 0.623948 3.24754 3.24827C0.623216 5.8726 0.623216 10.1275 3.24754 12.7518C5.87186 15.3761 10.1267 15.3761 12.7511 12.7518ZM6.23436 10.9416C5.90943 11.2665 5.38266 11.2665 5.05773 10.9416C4.73281 10.6167 4.73281 10.0899 5.05773 9.76497L6.82267 8.00003L5.05773 6.23509C4.73281 5.91017 4.73281 5.38339 5.05773 5.05847C5.38266 4.73354 5.90943 4.73354 6.23436 5.05847L7.9993 6.8234L9.76424 5.05847C10.0892 4.73354 10.6159 4.73354 10.9409 5.05847C11.2658 5.38339 11.2658 5.91017 10.9409 6.23509L9.17592 8.00003L10.9409 9.76497C11.2658 10.0899 11.2658 10.6167 10.9409 10.9416C10.6159 11.2665 10.0892 11.2665 9.76424 10.9416L7.9993 9.17666L6.23436 10.9416Z" fill="#b5b5b5"/></svg>`;
          spanElement.classList.add("list-item-status-value", "list-item-specific-value");
          spanElement.innerHTML = `${icon} False`;
        } else if (value === true || lowerCaseValue === "true") {
          const icon = `<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.00065 1.33325C4.32065 1.33325 1.33398 4.31992 1.33398 7.99992C1.33398 11.6799 4.32065 14.6666 8.00065 14.6666C11.6807 14.6666 14.6673 11.6799 14.6673 7.99992C14.6673 4.31992 11.6807 1.33325 8.00065 1.33325ZM6.66732 11.3333L3.33398 7.99992L4.27398 7.05992L6.66732 9.44659L11.7273 4.38659L12.6673 5.33325L6.66732 11.3333Z" fill="#b5b5b5"/></svg>`;
          spanElement.classList.add("list-item-status-value", "list-item-specific-value");
          spanElement.innerHTML = `${icon} True`;
        } else if (lowerCaseValue === "success") {
          const icon = `<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.00065 1.33325C4.32065 1.33325 1.33398 4.31992 1.33398 7.99992C1.33398 11.6799 4.32065 14.6666 8.00065 14.6666C11.6807 14.6666 14.6673 11.6799 14.6673 7.99992C14.6673 4.31992 11.6807 1.33325 8.00065 1.33325ZM6.66732 11.3333L3.33398 7.99992L4.27398 7.05992L6.66732 9.44659L11.7273 4.38659L12.6673 5.33325L6.66732 11.3333Z" fill="#99D7CA"/></svg>`;
          spanElement.classList.add("list-item-success-value", "list-item-specific-value");
          spanElement.innerHTML = `${icon} Success`;
        } else if (lowerCaseValue === "warning") {
          const icon = `<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.00065 1.33325C4.32065 1.33325 1.33398 4.31992 1.33398 7.99992C1.33398 11.6799 4.32065 14.6666 8.00065 14.6666C11.6807 14.6666 14.6673 11.6799 14.6673 7.99992C14.6673 4.31992 11.6807 1.33325 8.00065 1.33325ZM8.66732 11.3333H7.33398V7.33325H8.66732V11.3333ZM8.66732 5.99992H7.33398V4.66659H8.66732V5.99992Z" fill="#FFF371"/></svg>`;
          spanElement.classList.add("list-item-warning-value", "list-item-specific-value");
          spanElement.innerHTML = `${icon} Warning`;
        } else if (lowerCaseValue === "error") {
          const icon = `<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.00065 1.33325C4.32065 1.33325 1.33398 4.31992 1.33398 7.99992C1.33398 11.6799 4.32065 14.6666 8.00065 14.6666C11.6807 14.6666 14.6673 11.6799 14.6673 7.99992C14.6673 4.31992 11.6807 1.33325 8.00065 1.33325ZM8.66732 11.3333H7.33398V9.99992H8.66732V11.3333ZM8.66732 8.66659H7.33398V4.66659H8.66732V8.66659Z" fill="#FF5A50"/></svg>`;
          spanElement.classList.add("list-item-error-value", "list-item-specific-value");
          spanElement.innerHTML = `${icon} Error`;
        } else if (lowerCaseValue === "informational") {
          const icon = `<svg width="27" height="6" viewBox="0 0 27 6" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="3" cy="3" r="3" fill="#B2B6BD"/><circle cx="10" cy="3" r="3" fill="#B2B6BD"/><circle cx="17" cy="3" r="3" fill="#B2B6BD"/><circle cx="24" cy="3" r="3" fill="#B2B6BD"/></svg>`;
          spanElement.classList.add("list-item-specific-value");
          spanElement.innerHTML = `${icon} Informational`;
        } else if (lowerCaseValue === "low") {
          const icon = `<svg width="27" height="6" viewBox="0 0 27 6" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="3" cy="3" r="3" fill="#78D9EC"/><circle cx="10" cy="3" r="3" fill="#B2B6BD"/><circle cx="17" cy="3" r="3" fill="#B2B6BD"/><circle cx="24" cy="3" r="3" fill="#B2B6BD"/></svg>`;
          spanElement.classList.add("list-item-specific-value");
          spanElement.innerHTML = `${icon} Low`;
        } else if (lowerCaseValue === "medium") {
          const icon = `<svg width="27" height="6" viewBox="0 0 27 6" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="3" cy="3" r="3" fill="#FFF371"/><circle cx="10" cy="3" r="3" fill="#FFF371"/><circle cx="17" cy="3" r="3" fill="#B2B6BD"/><circle cx="24" cy="3" r="3" fill="#B2B6BD"/></svg>`;
          spanElement.classList.add("list-item-specific-value");
          spanElement.innerHTML = `${icon} Medium`;
        } else if (lowerCaseValue === "high") {
          const icon = `<svg width="27" height="6" viewBox="0 0 27 6" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="3" cy="3" r="3" fill="#FA903E"/><circle cx="10" cy="3" r="3" fill="#FA903E"/><circle cx="17" cy="3" r="3" fill="#FA903E"/><circle cx="24" cy="3" r="3" fill="#B2B6BD"/></svg>`;
          spanElement.classList.add("list-item-specific-value");
          spanElement.innerHTML = `${icon} High`;
        } else if (lowerCaseValue === "critical") {
          const icon = `<svg width="27" height="6" viewBox="0 0 27 6" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="3" cy="3" r="3" fill="#EC453B"/><circle cx="10" cy="3" r="3" fill="#EC453B"/><circle cx="17" cy="3" r="3" fill="#EC453B"/><circle cx="24" cy="3" r="3" fill="#EC453B"/></svg>`;
          spanElement.classList.add("list-item-specific-value");
          spanElement.innerHTML = `${icon} Critical`;
        } else if (/\.(png|jpg|jpeg|gif|bmp|webp)$/.test(lowerCaseValue)) {
          const icon = `<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="1" y="1" width="14" height="14" fill="white" stroke="#35424F" stroke-width="2" stroke-linejoin="round"/><path d="M12.6284 11.4587L10.0829 5.94357C10.0201 5.80781 9.89075 5.71533 9.74227 5.69963C9.59209 5.68393 9.44827 5.74714 9.35833 5.86678L7.06745 8.92129L5.70989 7.90312C5.60892 7.82761 5.47995 7.80046 5.35777 7.8293C5.23517 7.85815 5.13208 7.94003 5.07565 8.05245L3.3787 11.4464C3.31295 11.5779 3.32016 11.734 3.39737 11.8591C3.47458 11.9843 3.61119 12.0607 3.7584 12.0607H12.2432C12.3878 12.0607 12.5227 11.9868 12.6004 11.8651C12.6784 11.7433 12.689 11.5902 12.6284 11.4587Z" fill="#35424F"/><path d="M6.30396 6.1216C7.00686 6.1216 7.57668 5.55179 7.57668 4.84889C7.57668 4.14599 7.00686 3.57617 6.30396 3.57617C5.60106 3.57617 5.03125 4.14599 5.03125 4.84889C5.03125 5.55179 5.60106 6.1216 6.30396 6.1216Z" fill="#35424F"/></svg>`;
          spanElement.classList.add("list-item-specific-value");
          spanElement.innerHTML = `<button class="list-item-screenshot tag tag-item" data-modal="${value}" data-modal-button="item" data-modal-img="true">${icon} <span class="list-item-screenshot-text text-ellipsis">Screenshot</span></button>`;
        }
        li.appendChild(spanElement);
      }

      if (!spanElement.textContent) {
        return;
      }

      li.insertBefore(spanKey, li.firstChild);
      ul.appendChild(li);
    });

    mainContent.appendChild(ul);

    keys.forEach(({key, value}) => {
      if (Array.isArray(value)) {
        if (typeof value[0] !== "object") {
          return;
        }
        const tableWrapper = document.createElement("div");
        tableWrapper.classList.add("table-wrapper");
        const tableHeader = document.createElement("div");
        tableHeader.classList.add("table-header");
        const tableSearchInput = document.createElement("input");
        tableSearchInput.classList.add("input", "table-search-input");
        tableSearchInput.setAttribute("placeholder", "Search (regex)");
        const tableTitle = document.createElement("h2");
        tableTitle.classList.add("table-title");
        renderWithTooltip(tableTitle, `${convertCamelCaseToTitleCase(key)} Table`);
        const rowCountContainer = document.createElement("div");
        rowCountContainer.classList.add("table-row-count");

        function updateRowCount() {
          const visibleRows = Array.from(tbody.querySelectorAll("tr")).filter(row => row.style.display !== "none");
          const rowCount = visibleRows.length;
          const rowCountMessage = rowCount === 1 ? "Record found" : "Records found";
          rowCountContainer.innerHTML = `/ <span>${rowCount}</span> <span>${rowCountMessage}</span>`;
        }

        const tableContainer = document.createElement("div");
        const table = document.createElement("table");
        tableContainer.classList.add("table-container");
        table.classList.add("table");
        tableContainer.append(table);
        const thead = document.createElement("thead");
        const tbody = document.createElement("tbody");

        const tableDataMap = new Map();
        value.forEach((valuesObject, index) => {
          if (typeof valuesObject === "object") {
            for (const [key, value] of Object.entries(valuesObject)) {
              const currentValues = tableDataMap.get(key);
              if (currentValues) {
                if (currentValues.length < index) {
                  tableDataMap.set(key, currentValues.concat(new Array(index - currentValues.length).fill(""), [value]));
                } else {
                  tableDataMap.set(key, [...currentValues, value]);
                }
              } else {
                tableDataMap.set(key, [...new Array(index).fill("N/A"), value]);
              }
            }
          }
        });

        const headerRow = document.createElement("tr");
        Array.from(tableDataMap.keys()).forEach((subKey) => {
          const th = document.createElement("th");
          th.textContent = convertCamelCaseToTitleCase(subKey);
          headerRow.appendChild(th);
          renderWithTooltip(th, convertCamelCaseToTitleCase(subKey));
        });
        thead.appendChild(headerRow);

        const rowsCount = value.length;
        const tableValues = Array.from(tableDataMap.values());
        const valuesToRender = tableValues.map((values) => {
          const actualValuesCount = values.length;
          return actualValuesCount < rowsCount ? values.concat(new Array(rowsCount - actualValuesCount).fill("")) : values;
        });

        transposeArray(valuesToRender).forEach((values) => {
          const bodyRow = document.createElement("tr");

          values.forEach(subValue => {
            const td = document.createElement("td");
            if (typeof subValue === "object") {
              const button = document.createElement("button");
              button.innerHTML = `<span class="table-button-icon"><svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M5.2 4.09951C5.01435 4.09951 4.8363 4.17326 4.70503 4.30454C4.57375 4.43581 4.5 4.61386 4.5 4.79951V18.7995C4.5 19.1861 4.8134 19.4995 5.2 19.4995H8.7C9.0866 19.4995 9.4 19.1861 9.4 18.7995C9.4 18.4129 9.0866 18.0995 8.7 18.0995H5.9V5.49951H8.7C9.0866 5.49951 9.4 5.18611 9.4 4.79951C9.4 4.41291 9.0866 4.09951 8.7 4.09951H5.2Z" fill="white"/>
                                                    <path d="M19.2 4.09951H15.7C15.3134 4.09951 15 4.41291 15 4.79951C15 5.18611 15.3134 5.49951 15.7 5.49951H18.5V18.0995H15.7C15.3134 18.0995 15 18.4129 15 18.7995C15 19.1861 15.3134 19.4995 15.7 19.4995H19.2C19.5866 19.4995 19.9 19.1861 19.9 18.7995V4.79951C19.9 4.41291 19.5866 4.09951 19.2 4.09951Z" fill="white"/>
                                                    </svg></span>
                                                    <span class="table-button-text">Data Object</span>`;
              button.classList.add("table-button");
              button.setAttribute("data-modal", formatData(subValue));
              button.setAttribute("data-modal-button", "item");
              if (Array.isArray(subValue) && subValue.length === 0 || subValue === null) {
                td.innerHTML = "N/A";
              } else {
                td.appendChild(button);
                button.setAttribute("data-modal-title", convertCamelCaseToTitleCase(key));
              }
            } else {
              if (subValue !== "") {
                renderWithTooltip(td, subValue);
              } else {
                td.textContent = "N/A";
              }
            }
            bodyRow.appendChild(td);
          });
          thead.appendChild(headerRow);
          tbody.appendChild(bodyRow);
        });

        // Add search functionality
        tableSearchInput.addEventListener("input", () => {
          const searchValue = tableSearchInput.value;
          let regex;

          try {
            regex = new RegExp(searchValue, 'i');
          } catch (e) {
            regex = null;
          }

          const rows = tbody.querySelectorAll("tr");

          rows.forEach(row => {
            const cells = row.querySelectorAll("td");
            const match = Array.from(cells).some(cell => {
              const textContent = cell.textContent.toLowerCase();
              return regex ? regex.test(textContent) : textContent.includes(searchValue.toLowerCase());
            });
            row.style.display = match ? "" : "none";
          });

          updateRowCount();
        });

        updateRowCount();

        table.appendChild(thead);
        table.appendChild(tbody);
        tableHeader.appendChild(tableTitle);
        tableHeader.appendChild(rowCountContainer);
        tableHeader.appendChild(tableSearchInput);
        tableWrapper.appendChild(tableHeader);
        tableWrapper.appendChild(tableContainer);
        mainContent.appendChild(tableWrapper);
      }
    });
  }

  /**
   * Utility function to filter keys based on allowlistedFields
   */
  function filterKeys(obj, allowedKeys) {
    if (allowedKeys.length === 0) {
      return obj;
    }
    const filtered = {};
    allowedKeys.forEach(key => {
      if (obj.hasOwnProperty(key)) {
        filtered[key] = obj[key];
      }
    });
    return filtered;
  }

  /**
   * Formats data object into a human-readable string representation.
   */
  function formatData(data) {
    const isObject = obj => obj && obj.constructor === ({}).constructor;
    const formatIfObject = item => isObject(item) ? JSON.stringify(item, null, 4) : item;
    if (Array.isArray(data)) {
      return data.map(
        item => Array.isArray(item) ? formatData(item) : formatIfObject(item),
      ).join(",\n");
    }
    return formatIfObject(data);
  }

  /**
   * Removes special symbols from a string.
   */
  function removeSpecialSymbols(str) {
    return str.replace(/[^\w\s]/gi, "");
  }

  /**
   * Converts camelCaseName to Title Case.
   */
  function convertCamelCaseToTitleCase(str) {
    let result = str.replace(/_/g, " ");
    result = result.replace(/([a-z])([A-Z])/g, "$1 $2");
    result = result.replace(/\b\w/g, char => char.toUpperCase());
    return result;
  }

  /**
   * Creates a modal dialog with given content.
   */
  function createModal(content, title, isImage) {
    const modal = document.createElement("div");
    modal.classList.add("modal");
    const modalOverlay = document.createElement("div");
    modalOverlay.classList.add("modal-overlay");
    document.body.append(modalOverlay);
    const modalHeader = document.createElement("div");
    modalHeader.classList.add("modal-header");
    const modalTitle = document.createElement("h2");
    modalTitle.classList.add("modal-title");
    modalTitle.textContent = title;
    const closeButton = document.createElement("button");
    closeButton.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 6L6 18M6 6l12 12" />
        </svg>`;
    closeButton.classList.add("modal-close");
    modalHeader.append(modalTitle);
    modalHeader.append(closeButton);
    modal.append(modalHeader);
    const modalContent = document.createElement("div");
    modalContent.classList.add("modal-content");
    modal.append(modalContent);

    if (isImage) {
      const imgElement = document.createElement("img");
      imgElement.src = content;

      checkImageUrl(content, function (isValid) {
        if (isValid) {
          imgElement.src = content;
        } else {
          modalContent.innerText = "Image URL is broken";
        }
      });
      modalContent.append(imgElement);
    } else {
      const preElement = document.createElement("pre");
      preElement.textContent = content;
      modalContent.append(preElement);
    }
    document.body.append(modal);
    closeButton.addEventListener("click", () => {
      modal.remove();
      modalOverlay.remove();
    });
  }


  /**
   * Attaches modal creation behavior to elements with data-modal-button attribute.
   */
  function renderModal() {
    document.querySelectorAll("[data-modal-button=\"item\"]").forEach((button) => {
      button.addEventListener("click", () => {
        const content = button.getAttribute("data-modal");
        const title = button.getAttribute("data-modal-title");
        const isImage = button.getAttribute("data-modal-img") === "true";
        createModal(content, title, isImage);
      });
    });
  }

  /**
   * Creates a tooltip with given text and position.
   */
  function createTooltip(text, x, y, trianglePointX, placeAtBottom, contentOverflowWindow) {
    removeTooltip();
    const tooltip = document.createElement("div");
    tooltip.classList.add("tooltip");
    tooltip.textContent = text;
    tooltip.style.left = `${x}px`;
    tooltip.style.top = `${y}px`;
    if (contentOverflowWindow) {
      tooltip.style.right = `${tooltipGap}px`;
    }
    const tooltipTriangle = document.createElement("span");
    tooltipTriangle.classList.add("tooltip-triangle");
    tooltipTriangle.style.left = `${trianglePointX}px`;
    if (placeAtBottom) {
      tooltipTriangle.style.top = "-8px";
      tooltipTriangle.style.borderTop = "0";
      tooltipTriangle.style.borderBottom = "solid 8px rgb(195, 210, 232)";
    }
    tooltip.append(tooltipTriangle);
    document.body.append(tooltip);
  }

  /**
   * Removes any existing tooltip from the DOM.
   */
  function removeTooltip() {
    const tooltip = document.querySelectorAll(".tooltip");
    tooltip.forEach((item) => {
      if (item) {
        item.remove();
      }
    });
  }

  /**
   * Sets a timeout to calculate and show tooltip position after a delay.
   */
  function createTooltipListener(event) {
    tooltipTimeout = setTimeout(() => calculateTooltipPosition(event), 1000);
  }

  /**
   * Clears any existing tooltip timeout and removes the tooltip.
   */
  function removeTooltipListener() {
    if (tooltipTimeout) {
      clearTimeout(tooltipTimeout);
    }
    removeTooltip();
  }

  /**
   * Calculates and positions the tooltip relative to the event target.
   */
  function calculateTooltipPosition(event) {
    const target = event.target;
    if (!target) {
      return;
    }
    const viewportWidth = window.innerWidth;
    const rect = target.getBoundingClientRect();
    const tooltipContent = document.createElement("div");
    tooltipContent.classList.add("tooltip");
    tooltipContent.style.top = "0";
    tooltipContent.textContent = target.textContent;
    document.body.appendChild(tooltipContent);
    let contentOverflowWindow = false;
    // Determine if window width would not be enough for content of tooltip
    if (tooltipGap * 2 + tooltipContent.offsetWidth >= viewportWidth) {
      // setting left, right positions to get correct tooltipContentWidth and tooltipContentHeight
      tooltipContent.style.left = `${tooltipGap}px`;
      tooltipContent.style.right = `${tooltipGap}px`;
      contentOverflowWindow = true;
    }
    const tooltipContentWidth = tooltipContent.offsetWidth;
    const tooltipContentHeight = tooltipContent.offsetHeight;
    tooltipContent.remove();
    const elementMidX = rect.left + (rect.width / 2);
    const placeOnRight = elementMidX + tooltipContentWidth / 2 + tooltipGap > viewportWidth;
    const x = Math.max(tooltipGap, placeOnRight ? viewportWidth - tooltipContentWidth - tooltipGap : elementMidX - tooltipContentWidth / 2);
    const placeAtBottom = rect.top < tooltipContentHeight;
    const y = placeAtBottom ? rect.bottom + tooltipTriangleHeight : rect.top - tooltipContentHeight;
    // Calculating trianglePointX relative to window width, to guarantee that it is not out of window
    const trianglePointX = Math.min(Math.max(elementMidX - x, tooltipTriangleMinGap), tooltipContentWidth - tooltipTriangleMinGap - triangleWidth);
    createTooltip(target.textContent, x, y, trianglePointX, placeAtBottom, contentOverflowWindow);
  }

  /**
   * Renders an item with text and sets up tooltip behavior.
   */
  function renderWithTooltip(item, text) {
    item.innerText = text;
    item.classList.add("text-ellipsis");
    tooltipDetectResizeObserver.observe(item);
  }

  function checkImageUrl(url, callback) {
    const img = new Image();
    img.onload = function () {
      callback(true);
    };
    img.onerror = function () {
      callback(false);
    };
    img.src = url;
  }

  /**
   * Function to make a table resizable
   */
  function resizableGrid(table) {
    const row = table.getElementsByTagName("tr")[0],
      cols = row ? row.children : undefined;
    if (!cols) return;

    for (let i = 0; i < cols.length; i++) {
      const div = createDiv();
      cols[i].appendChild(div);
      cols[i].style.position = "relative";
      setListeners(div);
    }

    function setListeners(div) {
      let pageX, curCol, nxtCol, curColWidth, nxtColWidth, tableWidth;

      div.addEventListener("mousedown", function (e) {
        curCol = e.target.parentElement;
        nxtCol = curCol.nextElementSibling;
        pageX = e.pageX;

        const padding = paddingDiff(curCol);

        curColWidth = curCol.offsetWidth - padding;
        if (nxtCol) {
          nxtColWidth = nxtCol.offsetWidth - padding;
        }
      });

      document.addEventListener("mousemove", function (e) {
        if (curCol) {
          const diffX = e.pageX - pageX;
          if (nxtCol) {
            nxtCol.style.width = nxtColWidth - diffX + "px";
          }
          curCol.style.width = curColWidth + diffX + "px";
          table.style.width = tableWidth + diffX + "px";
          removeTooltipListener();
        }
      });

      document.addEventListener("mouseup", function () {
        curCol = undefined;
        nxtCol = undefined;
        pageX = undefined;
        nxtColWidth = undefined;
        curColWidth = undefined;
        tableWidth = undefined;
      });
    }

    function createDiv() {
      const div = document.createElement("div");
      div.classList.add("table-resizable-line");
      return div;
    }

    function paddingDiff(col) {
      if (getStyleVal(col, "box-sizing") === "border-box") {
        return 0;
      }

      const padLeft = getStyleVal(col, "padding-left");
      const padRight = getStyleVal(col, "padding-right");
      return parseInt(padLeft) + parseInt(padRight);
    }

    function getStyleVal(elm, css) {
      return window.getComputedStyle(elm, null).getPropertyValue(css);
    }
  }

  for (let i = 0; i < tables.length; i++) {
    resizableGrid(tables[i]);
  }

  /**
   * Counts the number of rows in each table's body.
   */
  function countTableBodyRows() {
    const tables = document.getElementsByClassName("table");

    const rowCounts = [];

    for (let i = 0; i < tables.length; i++) {
      const table = tables[i];
      const tbody = table.querySelector("tbody");

      if (tbody) {
        const rows = tbody.getElementsByTagName("tr");
        rowCounts.push(rows.length);
      } else {
        rowCounts.push(0);
      }
    }

    return rowCounts;
  }

  countTableBodyRows();
  </script>
 </body>
</html>
